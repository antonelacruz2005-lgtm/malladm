<!-- MALLA INTERACTIVA COMPLETA CON TOOLTIP FLOTANTE (FIXED) -->
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Malla Interactiva — Administración de Empresas</title>
<style>
:root{
  --rosa1:#ffd9ec;
  --rosa2:#ffecf6;
  --rosa3:#ffb6d9;
  --text:#5a4a4a;
  --card:#ffffff;
  --shadow:0 4px 12px rgba(0,0,0,0.15);
  --radius:14px;
  --prom:#ff6fa9;
  --reg:#ffd36e;
  --lib:#bababa;
  --disp:#cde4ff;
}
body{
  margin:0;
  font-family: "Poppins", sans-serif;
  background: var(--rosa1);
  color: var(--text);
}
header{
  padding:20px;
  text-align:center;
  font-size:28px;
  font-weight:700;
  background:var(--rosa3);
  color:white;
  box-shadow:var(--shadow);
}
.wrap{
  display:flex;
  gap:20px;
  padding:20px;
  overflow:visible !important;
}
.column{
  min-width:260px;
  background:var(--card);
  border-radius:var(--radius);
  padding:14px;
  box-shadow:var(--shadow);
  flex:0 0 auto;
  position:relative !important;
  overflow:visible !important;
}
.materia{
  position:relative;
  padding:12px;
  margin-bottom:10px;
  background:var(--rosa2);
  border-radius:var(--radius);
  cursor:pointer;
  box-shadow:var(--shadow);
  transition:0.2s;
}
.materia:hover{ transform:scale(1.02); }
.estado{ font-size:12px; font-weight:600; margin-top:4px; }
.notaBox{ margin-top:5px; font-size:12px; }
.tooltip-global{
  position:absolute;
  background:var(--rosa3);
  color:white;
  padding:12px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  font-size:13px;
  z-index:999999999 !important;
  display:none;
  max-width:260px;
}
#negrito{
  position:fixed;
  bottom:20px;
  left:20px;
  width:80px;
  image-rendering:pixelated;
  animation:caminar 6s linear infinite;
  z-index:99999999;
}
@keyframes caminar{
  0%{left:0px; transform:scaleX(1);} 
  50%{left:80%; transform:scaleX(1);} 
  51%{transform:scaleX(-1);} 
  100%{left:0px; transform:scaleX(-1);} 
}
#progresoBox{
  width:90%;
  margin:20px auto;
  background:white;
  padding:12px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
}
#barra{
  width:100%;
  height:20px;
  background:#eee;
  border-radius:var(--radius);
  overflow:hidden;
}
#barraAvance{
  height:100%;
  width:0%;
  background:var(--prom);
  border-radius:var(--radius);
}
</style>
</head>
<body>
<header>Malla Interactiva — Administración de Empresas</header>
<div id="progresoBox">
  <div>Progreso (Promocionadas): <span id="porcentaje">0%</span></div>
  <div id="barra"><div id="barraAvance"></div></div>
</div>
<div class="wrap" id="contenedor"></div>

<img id="negrito" src="data:image/png;base64,REPLACE_WITH_BASE64" />
<div id="tooltipGlobal" class="tooltip-global"></div>

<script>
const estados = ["Promoción", "Regular", "Libre", "Disponible"];

const materias = [
  {
    ciclo: "Ciclo de Nivelación",
    materias: [
      { nombre: "Área Matemática", req: [] },
      { nombre: "Área Integrada I", req: [] }
    ]
  },
  {
    ciclo: "Primer Año",
    materias: [
      { nombre: "Problemática Filosófica y Met. de las Ciencias", req: ["Área Integrada I"] },
      { nombre: "Álgebra", req: ["Área Matemática"] },
      { nombre: "Contabilidad Básica", req: ["Área Integrada I"] },
      { nombre: "Principios de Administración y Organización", req: ["Área Integrada I"] },
      { nombre: "Análisis Matemático", req: ["Álgebra"] },
      { nombre: "Microeconomía I", req: ["Álgebra"] }
    ]
  },
  {
    ciclo: "Segundo Año",
    materias: [
      { nombre: "Derecho Privado I", req: ["Área Integrada I", "Área Matemática"] },
      { nombre: "Administración", req: ["Principios de Administración y Organización"] },
      { nombre: "Contabilidad Superior", req: ["Contabilidad Básica"] },
      { nombre: "Matemática Financiera", req: ["Microeconomía I"] },
      { nombre: "Macroeconomía I", req: ["Microeconomía I"] },
      { nombre: "Estadística I", req: ["Análisis Matemático"] },
      { nombre: "Derecho Constitucional y Administrativo", req: ["Derecho Privado I"] },
      { nombre: "Área Integrada II", req: ["Principios de Administración y Organización", "Contabilidad Básica", "Álgebra", "Problemática Filosófica y Met. de las Ciencias", "Microeconomía I"] }
    ]
  },
  {
    ciclo: "Tercer Año",
    materias: [
      { nombre: "Créditos para Optativas (2)", req: [] },
      { nombre: "Idioma Inglés (Lectura comprensiva)", req: [] },
      { nombre: "Idioma Portugués (Lectura comprensiva)", req: [] },
      { nombre: "Sistemas Administrativos", req: ["Administración"] },
      { nombre: "Finanzas Públicas", req: ["Macroeconomía I", "Derecho Constitucional y Administrativo"] },
      { nombre: "Estadística II", req: ["Estadística I"] },
      { nombre: "Administración Estratégica", req: ["Sistemas Administrativos"] },
      { nombre: "Economía Aplicada", req: ["Macroeconomía I"] },
      { nombre: "Historia y Recursos Económicos", req: ["Área Matemática", "Área Integrada I", "Macroeconomía I"] },
      { nombre: "Derecho Empresario", req: ["Derecho Privado I"] }
    ]
  },
  {
    ciclo: "Cuarto Año",
    materias: [
      { nombre: "Psicología y Sociología Organizacional", req: ["Área Integrada II"] },
      { nombre: "Investigación Operativa", req: ["Estadística II"] },
      { nombre: "Costos para la Toma de Decisiones", req: ["Contabilidad Superior", "Matemática Financiera"] },
      { nombre: "Análisis de Estados Contables", req: ["Área Integrada II"] },
      { nombre: "Comercialización I", req: ["Administración Estratégica", "Investigación Operativa"] },
      { nombre: "Formación Tributaria", req: ["Finanzas Públicas"] },
      { nombre: "Administración Financiera", req: ["Matemática Financiera", "Análisis de Estados Contables"] },
      { nombre: "Área Integrada III", req: ["Derecho Privado I", "Contabilidad Superior", "Área Integrada II", "Administración Estratégica"] }
    ]
  },
  {
    ciclo: "Quinto Año",
    materias: [
      { nombre: "Comercialización II", req: ["Comercialización I"] },
      { nombre: "Administración de Personal", req: ["Psicología y Sociología Organizacional"] },
      { nombre: "Derecho Laboral y de la Seguridad Social", req: ["Derecho Constitucional y Administrativo"] },
      { nombre: "Evaluación de Proyectos", req: ["Economía Aplicada", "Administración Financiera"] },
      { nombre: "Administración de la Producción", req: ["Comercialización I"] },
      { nombre: "Área Integrada IV", req: ["Comercialización I", "Área Integrada III", "Administración Estratégica", "Administración Financiera", "Análisis de Estados Contables", "Derecho Empresario", "Economía Aplicada", "Estadística II", "Finanzas Públicas", "Formación Tributaria", "Historia y Recursos Económicos", "Psicología y Sociología Organizacional", "Sistemas Administrativos"] },
      { nombre: "Dirección y Gestión Empresaria", req: ["Área Integrada III", "Administración de Personal"] }
    ]
  }
];

const cont = document.getElementById("contenedor");
const tooltip = document.getElementById("tooltipGlobal");
const rootStyle = getComputedStyle(document.documentElement);

function crear(){
  cont.innerHTML="";
  materias.forEach(col=>{
    const c = document.createElement("div");
    c.className="column";

    const h = document.createElement("h3");
    h.textContent = col.ciclo;
    c.appendChild(h);

    col.materias.forEach(m=>{
      const card = document.createElement("div");
      card.className="materia";
      card.dataset.nombre=m.nombre;
      card.dataset.req=JSON.stringify(m.req);
      card.dataset.estado="Disponible";

      card.innerHTML = `${m.nombre}
        <div class='estado'>Disponible</div>
        <div class='notaBox'>Nota: <input type='number' min='1' max='10'></div>`;

      card.addEventListener("click", e=>{
        if(e.target.tagName==="INPUT") return;
        rotar(card);
      });

      card.addEventListener("mouseenter", ()=>{
        const req = JSON.parse(card.dataset.req);
        tooltip.style.display="block";
        tooltip.textContent = req.length ? "Correlativas: " + req.join(", ") : "Sin correlativas";
        const r = card.getBoundingClientRect();
        tooltip.style.top = (r.top + window.scrollY) + "px";
        tooltip.style.left = (r.right + 10 + window.scrollX) + "px";
      });

      card.addEventListener("mouseleave", ()=> tooltip.style.display="none");

      c.appendChild(card);
    });

    cont.appendChild(c);
  });
}

function rotar(card){
  let e = card.dataset.estado;
  let idx = estados.indexOf(e);
  idx = (idx + 1) % estados.length;
  card.dataset.estado = estados[idx];
  card.querySelector('.estado').textContent = estados[idx];
  colorear(card);
  guardar();
  actualizarProgreso();
}

function colorear(card){
  const e = card.dataset.estado;

  if(e === "Promoción"){
    card.style.background = rootStyle.getPropertyValue('--prom');
  } else if(e === "Regular"){
    card.style.background = rootStyle.getPropertyValue('--reg');
  } else if(e === "Libre"){
    card.style.background = rootStyle.getPropertyValue('--lib');
  } else {
    card.style.background = rootStyle.getPropertyValue('--rosa2');
  }
}

function guardar(){
  const data = {};
  document.querySelectorAll('.materia').forEach(m=>{
    data[m.dataset.nombre] = {
      estado: m.dataset.estado,
      nota: m.querySelector('input').value || ""
    };
  });
  localStorage.setItem('mallaAdmin', JSON.stringify(data));
}

function cargarProgreso(){
  const d = JSON.parse(localStorage.getItem('mallaAdmin') || "{}");
  document.querySelectorAll('.materia').forEach(m=>{
    if(d[m.dataset.nombre]){
      m.dataset.estado = d[m.dataset.nombre].estado;
      m.querySelector('input').value = d[m.dataset.nombre].nota;
      m.querySelector('.estado').textContent = d[m.dataset.nombre].estado;
      colorear(m);
    }
  });
}

function actualizarProgreso(){
  const mats = [...document.querySelectorAll('.materia')];
  const prom = mats.filter(m=>m.dataset.estado === "Promoción").length;
  const total = mats.length;
  const pct = Math.round((prom/total) * 100);

  document.getElementById('porcentaje').textContent = pct + "%";
  document.getElementById('barraAvance').style.width = pct + "%";
}

crear();
cargarProgreso();
actualizarProgreso();
</script>
</body>
</html>
