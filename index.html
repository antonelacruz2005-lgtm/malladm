<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Malla Interactiva — Administración de Empresas</title>
<style>
  :root{ --bg:#FFF6F8; --card:#FFF; --accent:#FDE2E4; --accent-2:#F8C8DC;
    --text:#2b1720; --muted:#6b5960; --ok:#2aa67a; --warn:#f0b429; --libre:#f28fa1;
    --shadow:0 10px 30px rgba(37,20,24,0.06); --radius:12px;
    font-family: Inter, "Segoe UI", Roboto, Arial, sans-serif; }
  html,body{height:100%;margin:0;padding:20px;background:linear-gradient(180deg,var(--bg),#fff);color:var(--text)}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{font-size:18px;margin:0}
  .subtitle{color:var(--muted);font-size:13px}
  .controls{display:flex;gap:8px;align-items:center}
  button{background:var(--accent-2);border:0;padding:8px 12px;border-radius:10px;cursor:pointer;color:#fff}
  button.ghost{background:transparent;color:var(--text);border:1px solid rgba(0,0,0,0.06);padding:8px 10px}
  input[type="file"]{display:none}
  .searchWrap{display:flex;gap:8px;align-items:center;background:var(--card);padding:12px;border-radius:12px;box-shadow:var(--shadow);margin-bottom:12px}
  .search{padding:8px 10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);min-width:320px}
  .small{font-size:13px;color:var(--muted)}
  .wrap{display:flex;gap:16px;overflow:auto;padding-bottom:14px}
  /* FIX: position + overflow + z-index para que tooltips no queden debajo */
  .column{min-width:240px;background:var(--card);border-radius:var(--radius);padding:14px;box-shadow:var(--shadow);flex:0 0 260px; position: relative; z-index:1; overflow: visible;}
  .column h2{margin:0 0 10px 0;font-size:14px;color:#4a2730}
  .grid{display:flex;flex-direction:column;gap:10px}
  .subject{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg,#fffafc,#fff);border:1px solid rgba(37,20,24,0.04);transition: transform .14s ease, box-shadow .14s ease, background .18s; position:relative; cursor:pointer;}
  .subject:hover{ transform: translateY(-4px); box-shadow: 0 12px 28px rgba(37,20,24,0.06); }
  .subject.locked{ opacity:0.75; filter:grayscale(.02); cursor:default; transform:none; box-shadow:none; }
  .subject .left{display:flex;align-items:center;gap:10px;min-width:0}
  .subject .name{ font-weight:700; font-size:13px; color:var(--text); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  .subject .meta{ font-size:12px; color:var(--muted); min-width:92px; text-align:right; }
  .badge-state{ margin-left:8px;padding:4px 8px;border-radius:999px;font-size:12px;color:white;font-weight:700;cursor:pointer;border:0 }
  .badge-prom{ background:var(--ok) }
  .badge-reg{ background:var(--warn); color:#4a2b00 }
  .badge-lib{ background:var(--libre); color:#4a0b1b }
  .subject.approved{ border-left:6px solid var(--ok); background: linear-gradient(180deg,#fffaf8,#fff) }
  .tooltip{ position:absolute; left:calc(100% + 12px); top:6px; width:320px; background: linear-gradient(180deg,#ffeef6,#ffdff0); color:#2b0b15; padding:10px; border-radius:10px; font-size:13px; box-shadow:0 10px 30px rgba(37,20,24,0.08); display:none; z-index:9999; border:1px solid rgba(0,0,0,0.04); }
  .tooltip b{display:block;margin-bottom:6px}
  .subject.locked:hover .tooltip{ display:block }
  @keyframes pop {0%{transform:scale(.94);opacity:0}40%{transform:scale(1.10);opacity:1}100%{transform:scale(1);opacity:1}}
  .pop{animation:pop .38s cubic-bezier(.2,.9,.2,1);box-shadow:0 14px 34px rgba(37,20,24,0.08) !important}
  .mascot{position:fixed; left:10px; bottom:40px; width:96px; height:96px; border-radius:8px; overflow:visible; z-index:120; display:flex;align-items:center;justify-content:center; pointer-events:auto;}
  .mascot img{ width:96px; height:96px; image-rendering: pixelated; display:block; transform-origin:center; transition: transform .18s ease; }
  @media (max-width:900px){ .wrap{padding-bottom:12px} .column{min-width:220px} .tooltip{display:none} .mascot{display:none} }
  .controls .small{min-width:140px;text-align:right}
</style>
</head>
<body>
<header>
  <div><h1>Malla Interactiva — Administración de Empresas</h1><div class="subtitle">Progreso local — tema rosa</div></div>
  <div class="controls">
    <div class="small" id="statusSummary">Cargando...</div>
    <button id="exportBtn">Exportar</button>
    <label for="importFile" class="ghost" style="padding:8px 10px;border-radius:10px;cursor:pointer">Importar</label>
    <input type="file" id="importFile" accept="application/json">
    <button id="resetBtn" class="ghost">Reiniciar</button>
  </div>
</header>

<section class="searchWrap">
  <input id="searchInput" class="search" placeholder="Buscar materia por nombre..." aria-label="Buscar materias">
  <div class="small" style="min-width:120px;text-align:right">Visibles: <span id="filterCount">—</span></div>
  <div style="margin-left:8px"><a href="LAE - RÉGIMEN DE CORRELATIVIDADES.pdf" target="_blank" style="text-decoration:none;color:#b23a6b;font-weight:600">Ver PDF correlatividades</a></div>
</section>

<main>
  <div class="wrap" id="wrap">
    <div class="column" id="col0"><h2>Nivelación</h2><div class="grid" id="grid0"></div></div>
    <div class="column" id="col1"><h2>1er Año</h2><div class="grid" id="grid1"></div></div>
    <div class="column" id="col2"><h2>2do Año</h2><div class="grid" id="grid2"></div></div>
    <div class="column" id="col3"><h2>3er Año</h2><div class="grid" id="grid3"></div></div>
    <div class="column" id="col4"><h2>4to Año</h2><div class="grid" id="grid4"></div></div>
    <div class="column" id="col5"><h2>5to Año</h2><div class="grid" id="grid5"></div></div>
    <div class="column" id="col6"><h2>Extracurriculares</h2><div class="grid" id="grid6"></div></div>
  </div>
  <div style="margin-top:10px" class="small">Nota: Clic izquierdo marca/desmarca <strong>Promoción</strong> (desbloquea correlativas). Clic en el estado lateral permite elegir Promoción/Regular/Libre.</div>
</main>

<div class="mascot" id="mascot" title="Negro, tu mascota">
    <img id="mascotImg" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzAwMCIgZD0iTTEyIDJjLTYuMDc1IDAtMTIgNC40NzctMTIgMTBzNS4zNzMgMTIgMTIgMTIgMTItNC40NzcgMTItMTJTMjguMDc1IDIgMTIgMnpNMTAgOGExIDEtMSAxIDAgMiAwIDFhMSAxIDAgMCAxIDAtMnptNCAwYTEgMSAwIDEgMSAwIDJhMSAxIDAgMCAxIDAtMnptLTUgNy41YTQgNCAtMSAwIDEtOCAwaDguNThsLjU1LTIuMjlsLS4wNy4xMi0uNDYuMTctLjA4LS4zNWMuODEtLjIgMS4wMi0uMyAxLjE4LS40YS41LjUgMCAwIDEtLjM5Ljk4em0tMi41LjVhLjUuNSAwIDAgMSAwLTFoNWEuNS41IDAgMCAxIDAgMVoiLz48L3N2Zz4=" alt="Gato">
</div>

<script>
/* Datos y persistencia */
const STORAGE_KEY = 'malla_interactiva_admin_empresas_v1_states';
const subjects = [
  // Nivelación (Columna 0) - Mapeados como 'LA0'
  {id:'LA001', name:'MATEMÁTICAS', req:[], year:0}, // MATEMÁTICAS
  {id:'LA002', name:'ÁREA INTEGRADA I', req:[], year:0}, // ÁREA INTEGRADA

  // Primer Año (Columna 1)
  {id:'LA101', name:'Problemática Filosófica y Metodología de las Ciencias', req:['LA002'], year:1},
  {id:'LA102', name:'ÁLGEBRA', req:['LA001'], year:1},
  {id:'LA103', name:'Contabilidad Básica', req:['LA002'], year:1},
  {id:'LA104', name:'Principios de Administración y Organización', req:['LA002'], year:1},
  {id:'LA105', name:'Análisis Matemático', req:['LA102'], year:1},
  {id:'LA106', name:'Microeconomía I', req:['LA102'], year:1},

  // Segundo Año (Columna 2)
  {id:'LA201', name:'Derecho Privado I', req:['LA002','LA001'], year:2},
  {id:'LA202', name:'Administración', req:['LA104'], year:2},
  {id:'LA203', name:'Contabilidad Superior', req:['LA103'], year:2},
  {id:'LA204', name:'Matemática Financiera', req:['LA106'], year:2},
  {id:'LA205', name:'Macroeconomía I', req:['LA106'], year:2},
  {id:'LA206', name:'Estadística I', req:['LA105'], year:2},
  {id:'LA207', name:'Derecho Constitucional y Administrativo', req:['LA201'], year:2},
  {id:'LA208', name:'Área Integrada II', req:['LA101','LA102','LA103','LA104','LA106'], year:2},

  // Tercer Año (Columna 3)
  {id:'OPT02', name:'Créditos para Optativas (2)', req:[], year:3},
  {id:'LA301', name:'Sistemas Administrativos', req:['LA202'], year:3},
  {id:'LA302', name:'Finanzas Públicas', req:['LA205','LA207'], year:3},
  {id:'LA303', name:'Estadística II', req:['LA206'], year:3},
  {id:'LA304', name:'Administración Estratégica', req:['LA301'], year:3},
  {id:'LA305', name:'Economía Aplicada', req:['LA205'], year:3},
  {id:'LA306', name:'Historia y Recursos Económicos', req:['LA001','LA002','LA205'], year:3},
  {id:'LA307', name:'Derecho Empresario', req:['LA201'], year:3},

  // Cuarto Año (Columna 4) - Se requiere Inglés/Portugués/Módulos (LA8xx)
  {id:'LA401', name:'Psicología y Sociología Organizacional', req:['LA208','LA810','LA811','LA801','LA802','LA803','LA805','LA807'], year:4},
  {id:'LA402', name:'Investigación Operativa', req:['LA303','LA810','LA811','LA801','LA802','LA803','LA805','LA807'], year:4},
  {id:'LA403', name:'Costos para la Toma de Decisiones', req:['LA203','LA204','LA810','LA811','LA801','LA802','LA803','LA805','LA807'], year:4},
  {id:'LA404', name:'Análisis de Estados Contables', req:['LA208','LA810','LA811','LA801','LA802','LA803','LA805','LA807'], year:4},
  {id:'LA405', name:'Comercialización I', req:['LA304','LA402'], year:4},
  {id:'LA406', name:'Formación Tributaria', req:['LA302','LA810','LA811','LA801','LA802','LA803','LA805','LA807'], year:4},
  {id:'LA407', name:'Administración Financiera', req:['LA204','LA404'], year:4},
  {id:'LA408', name:'Área Integrada III', req:['LA201','LA203','LA208','LA304','LA810','LA811','LA801','LA802','LA803','LA805','LA807'], year:4},

  // Quinto Año (Columna 5)
  {id:'LA501', name:'Comercialización II', req:['LA405'], year:5},
  {id:'LA502', name:'Administración de Personal', req:['LA401'], year:5},
  {id:'LA503', name:'Derecho Laboral y de la Seguridad Social', req
